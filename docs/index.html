<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Investec Developer Community Builds</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
      background: #f9f9f9;
      color: #222;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 0.3em;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .submit-button {
      background: #000;
      color: white;
      padding: 10px 14px;
      border-radius: 6px;
      font-weight: bold;
      text-decoration: none;
    }
    .submit-button:hover {
      background: #333;
    }
    #search {
      padding: 8px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
      max-width: 300px;
      margin: 20px 0;
    }
    #builds {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    @media(min-width: 768px) {
      #builds {
        grid-template-columns: 1fr 1fr;
      }
    }
    .build-card {
      background: #fff;
      border: 1px solid #ddd;
      border-left: 6px solid #000;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .build-card h2 {
      margin: 0 0 0.5em;
      font-weight: bold;
    }
    .build-card p {
      margin: 0.5em 0;
    }
    .meta {
      color: #666;
      font-size: 0.9em;
    }
    .screenshots img {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 4px;
      border: 1px solid #eee;
    }
    .copy-btn {
      background: #eee;
      font-size: 0.9em;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      margin-left: 5px;
    }
    a {
      color: #000;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .loading {
      font-style: italic;
      font-size: 1em;
      padding: 20px;
      text-align: center;
    }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #000;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .top-link {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #000;
      color: white;
      padding: 10px 14px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>üöÄ Investec Developer Community Builds</h1>
    <a class="submit-button" href="https://github.com/Investec-Developer-Community/.github/issues/new?template=build-submission.yml" target="_blank">
      Submit Your Build
    </a>
  </div>

  <p>Welcome to our community showcase! Here you‚Äôll find builds created by fellow Investec Developer community members ‚Äî tools, dashboards, automations, and experiments made using our APIs or internal tech. Browse for inspiration, reuse cool ideas, or share your own.</p>

  <input id="search" type="text" placeholder="Search builds..." />

  <div id="builds"><div class="spinner"></div><p class="loading">Loading builds...</p></div>
  <a href="#" class="top-link">‚Üë</a>

  <script>
    let allIssues = [];

    const extractSection = (body, label) => {
      const regex = new RegExp(`###\s*${label}\s*\n+([\s\S]*?)(?=\n###|$)`, "i");
      const match = body.match(regex);
      return match ? match[1].trim() : "";
    };

    const copyToClipboard = (text) => {
      navigator.clipboard.writeText(text).then(() => alert("Copied to clipboard!"));
    };

    const renderBuilds = (issues) => {
      const container = document.getElementById("builds");
      container.innerHTML = "";

      if (!issues.length) {
        container.innerHTML = "<p>No matching builds found.</p>";
        return;
      }

      issues.forEach(issue => {
        const body = issue.body || "";

        const projectName = extractSection(body, "Project Name") || issue.title;
        const author = extractSection(body, "Your Name or Team") || issue.user.login;
        const description = extractSection(body, "Description");
        const repoLink = extractSection(body, "Repository/Code Link");
        const liveDemo = extractSection(body, "Live Demo (if any)");
        const instructions = extractSection(body, "How to Run/Use It");
        const screenshots = extractSection(body, "Screenshots or GIFs");
        const imageUrls = (screenshots.match(/https?:\/\/\S+\.(png|jpg|jpeg|gif)/gi) || []);
        const createdAt = new Date(issue.created_at).toLocaleDateString();
        const placeholderImage = 'https://placehold.co/600x400?text=No+Screenshot';

        const card = document.createElement("div");
        card.className = "build-card";
        card.innerHTML = `
          <h2>${projectName}</h2>
          <p><strong>Submitted by:</strong> ${author}</p>
          <p class="meta">üïí Submitted on ${createdAt}</p>
          ${description ? `<p>${description}</p>` : "<p><em>No description provided.</em></p>"}
          <div class="screenshots">
            <img src="${imageUrls[0] || placeholderImage}" alt="Build Screenshot">
          </div>
          ${repoLink ? `<p>üì¶ <a href="${repoLink}" target="_blank">View Repository</a></p>` : ""}
          ${liveDemo && liveDemo.toLowerCase() !== "no response" ? `<p>üöÄ <a href="${liveDemo}" target="_blank">Live Demo</a></p>` : ""}
          ${instructions ? `<p><strong>How to Run:</strong><br><code>${instructions}</code><button class="copy-btn" onclick="copyToClipboard(\`${instructions}\`)">üìã Copy</button></p>` : ""}
          <p class="meta">üìù <a href="${issue.html_url}" target="_blank">View Submission</a></p>
        `;
        container.appendChild(card);
      });
    };

    async function loadBuilds() {
      try {
        const res = await fetch("./builds.json");
        if (!res.ok) throw new Error("Failed to load builds.json");
        const issues = await res.json();
        allIssues = issues.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
        renderBuilds(allIssues);
      } catch (err) {
        document.getElementById("builds").innerHTML = `<p>‚ö†Ô∏è Error loading builds: ${err.message}</p>`;
      }
    }

    document.getElementById("search").addEventListener("input", e => {
      const q = e.target.value.toLowerCase();
      const filtered = allIssues.filter(issue => {
        const body = issue.body.toLowerCase();
        const title = issue.title.toLowerCase();
        return title.includes(q) || body.includes(q);
      });
      renderBuilds(filtered);
    });

    loadBuilds();
  </script>
</body>
</html>
